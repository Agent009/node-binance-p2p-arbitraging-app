<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Binance P2P Arbitraging Calculator</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD"
      crossorigin="anonymous"
    />
    <script src="https://kit.fontawesome.com/1823996335.js" crossorigin="anonymous"></script>
  </head>
  <body>
    <div class="container">
      <h1 class="mb-3 mt-5 text-center">Binance P2P Arbitraging App</h1>
      <div id="app">
        <form v-on:submit.prevent="getResults" class="mb-5 p-5">
          <h3>BUY</h2>
          <div class="mb-3">
            <label class="form-label">Currency</label>
            <input
              type="text"
              class="form-control"
              v-model="buyCurrency"
            />
          </div>
          <div class="mb-3">
              <label class="form-label">Amount</label>
              <input
                type="text"
                class="form-control"
                v-model="buyAmount"
              />
          </div>
          <h3>SELL</h2>
              <div class="mb-3">
                <label class="form-label">Currency</label>
                <input
                  type="text"
                  class="form-control"
                  v-model="sellCurrency"
                />
              </div>
              <button type="submit" class="btn btn-primary btn-lg">Submit</button>
              <div class="mb-3">
                  <div v-show="processingIcon" class="mt-3 text-center">
                    <i class="fa-solid fa-arrows-spin fa-spin fa-6x"></i>
                  </div>
                  <div v-show="showData">
                    <div class="row">
                      <div class="col-sm-4 mt-3">
                        <h2>Buy Details</h2>
                        <div class="h4"><span class="fw-bold">Advertiser: </span> {{ buyAdvertiser }}</div>
                        <div class="h4"><span class="fw-bold">Price: </span> {{ buyPrice }}</div>
                        <div class="h4"><span class="fw-bold">Amount: </span> {{ boughtUSDT }} USDT</div>
                        <a :href="`https://p2p.binance.com/en/advertiserDetail?advertiserNo=${buyAdvId}`" target="_blank" class="btn btn-dark">Visit Ad {{ buyAdvId }}</a>
                      </div>
                      <div class="col-sm-4 mt-3">
                        <h2>Sell Details</h2>
                        <div class="h4"><span class="fw-bold">Advertiser: </span> {{ sellAdvertiser }}</div>
                        <div class="h4"><span class="fw-bold">Price: </span> {{ sellPrice }}</div>
                        <div class="h4"><span class="fw-bold">Amount: </span> {{ soldCurrencyAmount }} {{ sellCurrency }}</div>
                        <a :href="`https://p2p.binance.com/en/advertiserDetail?advertiserNo=${sellAdvId}`"  target="_blank" class="btn btn-dark">Visit Ad {{ sellAdvId }}</a>
                      </div>
                      <div class="col-sm-4 mt-3">
                        <h2>Fiat Details</h2>
                        <div class="h4"><span class="fw-bold">Buy Amount: </span> {{ buyAmount }} {{ buyCurrency }} </div>
                        <div class="h4"><span class="fw-bold">Exchange Rate: </span> {{ fiatRate }} {{ sellCurrency }} </div>
                        <div class="h4"><span class="fw-bold">Total Amount: </span> {{ fiatTotalAmount }} {{ sellCurrency }}</div>
                      </div>
                    </div>
                  </div>
              </div>
        </form>
      </div>
    </div>
  </body>
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
    crossorigin="anonymous"
  ></script>
  <script src="https://unpkg.com/vue@next"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    Vue.createApp({
      data() {
        return {
          processingIcon: false,
          showData: false,
          buyCurrency: 'GBP',
          buyAmount: 143,
          sellCurrency: 'PKR',
          buyAdvId: null, 
          buyAdvertiser: null,
          buyPrice: null,
          boughtUSDT: null,
          sellAdvId: null,
          sellAdvertiser: null,
          sellPrice: null,
          soldCurrencyAmount: null,
          fiatRate: null,
          fiatTotalAmount: null
        };
      },
      methods: { 
        getResults() {
          // Hide the data and show the processing icon
          this.processingIcon = true;
          this.showData = false;
          axios.get('/get-results', {
            params: {
              buyCurrency: this.buyCurrency,
              buyAmount: this.buyAmount,
              sellCurrency: this.sellCurrency
            }
          }).then((response) => {
              this.buyAdvId = response.data.buyAdvId;
              this.buyAdvertiser = response.data.buyAdvertiser;
              this.buyPrice = response.data.buyPrice;
              this.boughtUSDT = Math.round(response.data.boughtUSDT * 100) / 100;
              this.sellAdvId = response.data.sellAdvId;
              this.sellAdvertiser = response.data.sellAdvertiser;
              this.sellPrice = response.data.sellPrice;
              this.soldCurrencyAmount = Math.round(response.data.soldCurrencyAmount * 100) / 100;
              this.fiatRate = response.data.fiatRate;
              this.fiatTotalAmount = response.data.fiatTotalAmount;

              // Show data and hide the processing icon
              this.processingIcon = false;
              this.showData = true;
          });
        }
      }
    }).mount('#app');
  </script>
</html>
